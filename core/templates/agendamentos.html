{% extends 'base.html' %}
{% block content %}
<h2 class="text-2xl">Agenda</h2>

<div id='calendar'></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'timeGridWeek',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'timeGridWeek,timeGridDay,dayGridMonth'
    },
    selectable: true,
    select: function(info) {
      const start = info.startStr;
      const end = info.endStr;

      if (!confirm(`Agendar para ${start}?`)) { return; }

      // criar via API
      fetch('{% url "api_appointments" %}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({
          doctor: parseInt(prompt('ID do médico (veja a lista)')),
          start: start,
          end: end
        })
      }).then(res => {
        if (res.ok) { calendar.refetchEvents(); }
        else { alert('Erro ao criar agendamento'); }
      });
    },
    events: {
      url: '{% url "api_appointments" %}',
      method: 'GET',
      extraParams: {},
      failure: function() {
        alert('Erro ao carregar eventos');
      }
    },
    eventDidMount: function(info) {
        // estilizar ou tooltip
    }
  });

  calendar.render();
});
</script>

<div class="mt-6">
  <h4>Médicos (IDs)</h4>
  <ul>
    {% for m in doctors %}
      <li>{{ m.id }} — {{ m }}</li>
    {% endfor %}
  </ul>
</div>

{% endblock %}
